openapi: 3.1.0
info:
  title: Split-Bill API
  version: 1.0.0
  description: Frozen v1 OpenAPI contract for FE/BE parallel implementation.
servers:
  - url: http://localhost:8080
security:
  - bearerAuth: []
paths:
  /auth/register:
    post: { tags: [Auth], security: [], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/RegisterRequest' } } } }, responses: { '201': { $ref: '#/components/responses/AuthSession' }, '400': { $ref: '#/components/responses/ValidationError' }, '409': { $ref: '#/components/responses/Error' } } }
  /auth/verify-email:
    post: { tags: [Auth], security: [], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/VerifyEmailRequest' } } } }, responses: { '200': { $ref: '#/components/responses/Message' }, '400': { $ref: '#/components/responses/ValidationError' }, '404': { $ref: '#/components/responses/Error' } } }
  /auth/login:
    post: { tags: [Auth], security: [], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/LoginRequest' } } } }, responses: { '200': { $ref: '#/components/responses/AuthSession' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' } } }
  /auth/refresh:
    post: { tags: [Auth], security: [], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/RefreshRequest' } } } }, responses: { '200': { $ref: '#/components/responses/AuthSession' }, '401': { $ref: '#/components/responses/Error' } } }
  /auth/logout:
    post: { tags: [Auth], responses: { '204': { description: Session invalidated }, '401': { $ref: '#/components/responses/Error' } } }
  /me:
    get: { tags: [Profile], responses: { '200': { $ref: '#/components/responses/Profile' }, '401': { $ref: '#/components/responses/Error' } } }
  /me/preferences:
    patch: { tags: [Profile], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/UpdatePreferencesRequest' } } } }, responses: { '200': { $ref: '#/components/responses/Profile' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' } } }
  /events:
    get: { tags: [Events], parameters: [ { $ref: '#/components/parameters/Page' }, { $ref: '#/components/parameters/PageSize' } ], responses: { '200': { $ref: '#/components/responses/EventList' }, '401': { $ref: '#/components/responses/Error' } } }
    post: { tags: [Events], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/CreateEventRequest' } } } }, responses: { '201': { $ref: '#/components/responses/Event' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    get: { tags: [Events], responses: { '200': { $ref: '#/components/responses/EventDetails' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
    patch: { tags: [Events], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/UpdateEventRequest' } } } }, responses: { '200': { $ref: '#/components/responses/Event' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
    delete: { tags: [Events], responses: { '204': { description: Deleted }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/people:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    post: { tags: [People], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/CreatePersonRequest' } } } }, responses: { '201': { $ref: '#/components/responses/Person' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/people/{personId}:
    parameters: [ { $ref: '#/components/parameters/EventId' }, { $ref: '#/components/parameters/PersonId' } ]
    patch: { tags: [People], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/UpdatePersonRequest' } } } }, responses: { '200': { $ref: '#/components/responses/Person' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/entries:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    post: { tags: [Entries], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/CreateEntryRequest' } } } }, responses: { '201': { $ref: '#/components/responses/Entry' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/entries/{entryId}:
    parameters: [ { $ref: '#/components/parameters/EventId' }, { $ref: '#/components/parameters/EntryId' } ]
    patch: { tags: [Entries], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/UpdateEntryRequest' } } } }, responses: { '200': { $ref: '#/components/responses/Entry' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
    delete: { tags: [Entries], responses: { '204': { description: Deleted }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/invites:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    post: { tags: [Invites], requestBody: { required: false, content: { application/json: { schema: { $ref: '#/components/schemas/CreateInviteRequest' } } } }, responses: { '201': { $ref: '#/components/responses/Invite' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /invites/{token}/join:
    post: { tags: [Invites], parameters: [ { $ref: '#/components/parameters/InviteToken' } ], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/JoinInviteRequest' } } } }, responses: { '200': { $ref: '#/components/responses/JoinInvite' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/balances:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    get: { tags: [Balances], parameters: [ { name: algorithm, in: query, required: false, schema: { $ref: '#/components/schemas/SettlementAlgorithm' } } ], responses: { '200': { $ref: '#/components/responses/Balances' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/analytics/daily-spend:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    get: { tags: [Analytics], parameters: [ { $ref: '#/components/parameters/DateFrom' }, { $ref: '#/components/parameters/DateTo' }, { $ref: '#/components/parameters/PersonIds' } ], responses: { '200': { $ref: '#/components/responses/DailySpend' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /events/{eventId}/analytics/category-spend:
    parameters: [ { $ref: '#/components/parameters/EventId' } ]
    get: { tags: [Analytics], parameters: [ { $ref: '#/components/parameters/DateFrom' }, { $ref: '#/components/parameters/DateTo' }, { $ref: '#/components/parameters/PersonIds' } ], responses: { '200': { $ref: '#/components/responses/CategorySpend' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' }, '403': { $ref: '#/components/responses/Error' }, '404': { $ref: '#/components/responses/Error' } } }
  /uploads/presign:
    post: { tags: [Uploads], requestBody: { required: true, content: { application/json: { schema: { $ref: '#/components/schemas/PresignRequest' } } } }, responses: { '200': { $ref: '#/components/responses/Presign' }, '400': { $ref: '#/components/responses/ValidationError' }, '401': { $ref: '#/components/responses/Error' } } }
components:
  securitySchemes:
    bearerAuth: { type: http, scheme: bearer, bearerFormat: JWT }
  parameters:
    EventId: { name: eventId, in: path, required: true, schema: { type: string, format: uuid } }
    PersonId: { name: personId, in: path, required: true, schema: { type: string, format: uuid } }
    EntryId: { name: entryId, in: path, required: true, schema: { type: string, format: uuid } }
    InviteToken: { name: token, in: path, required: true, schema: { type: string, minLength: 20 } }
    Page: { name: page, in: query, required: false, schema: { type: integer, minimum: 1, default: 1 } }
    PageSize: { name: pageSize, in: query, required: false, schema: { type: integer, minimum: 1, maximum: 100, default: 20 } }
    DateFrom: { name: fromDate, in: query, required: false, schema: { type: string, format: date } }
    DateTo: { name: toDate, in: query, required: false, schema: { type: string, format: date } }
    PersonIds: { name: personIds, in: query, required: false, style: form, explode: false, schema: { type: array, maxItems: 50, items: { type: string, format: uuid } } }
  responses:
    Error: { description: Generic error, content: { application/json: { schema: { $ref: '#/components/schemas/ErrorResponse' } } } }
    ValidationError: { description: Validation error, content: { application/json: { schema: { $ref: '#/components/schemas/ValidationErrorResponse' } } } }
    Message: { description: Message, content: { application/json: { schema: { $ref: '#/components/schemas/MessageResponse' } } } }
    AuthSession: { description: Auth session, content: { application/json: { schema: { $ref: '#/components/schemas/AuthSessionResponse' } } } }
    Profile: { description: Profile, content: { application/json: { schema: { $ref: '#/components/schemas/AccountProfileResponse' } } } }
    EventList: { description: Events page, content: { application/json: { schema: { $ref: '#/components/schemas/EventListResponse' } } } }
    Event: { description: Event payload, content: { application/json: { schema: { $ref: '#/components/schemas/EventResponse' } } } }
    EventDetails: { description: Event details payload, content: { application/json: { schema: { $ref: '#/components/schemas/EventDetailsResponse' } } } }
    Person: { description: Person payload, content: { application/json: { schema: { $ref: '#/components/schemas/PersonResponse' } } } }
    Entry: { description: Entry payload, content: { application/json: { schema: { $ref: '#/components/schemas/EntryResponse' } } } }
    Invite: { description: Invite payload, content: { application/json: { schema: { $ref: '#/components/schemas/InviteResponse' } } } }
    JoinInvite: { description: Join invite payload, content: { application/json: { schema: { $ref: '#/components/schemas/JoinInviteResponse' } } } }
    Balances: { description: Balances payload, content: { application/json: { schema: { $ref: '#/components/schemas/BalancesResponse' } } } }
    DailySpend: { description: Daily spend payload, content: { application/json: { schema: { $ref: '#/components/schemas/DailySpendResponse' } } } }
    CategorySpend: { description: Category spend payload, content: { application/json: { schema: { $ref: '#/components/schemas/CategorySpendResponse' } } } }
    Presign: { description: Upload presign payload, content: { application/json: { schema: { $ref: '#/components/schemas/PresignResponse' } } } }
  schemas:
    CurrencyCode: { type: string, pattern: '^[A-Z]{3}$' }
    SettlementAlgorithm: { type: string, enum: [MIN_TRANSFER, PAIRWISE] }
    EntryType: { type: string, enum: [EXPENSE, INCOME] }
    SplitMode: { type: string, enum: [EVEN, PERCENT, AMOUNT] }
    ErrorResponse: { type: object, required: [code, message, traceId], properties: { code: { type: string }, message: { type: string }, traceId: { type: string }, details: { type: object, additionalProperties: true } } }
    ValidationErrorResponse: { allOf: [ { $ref: '#/components/schemas/ErrorResponse' }, { type: object, required: [errors], properties: { errors: { type: array, items: { type: object, required: [field, message], properties: { field: { type: string }, message: { type: string } } } } } } ] }
    MessageResponse: { type: object, required: [message], properties: { message: { type: string } } }
    MoneyDto: { type: object, required: [amount, currency], properties: { amount: { type: string, pattern: '^-?[0-9]+(\.[0-9]{1,4})?$' }, currency: { $ref: '#/components/schemas/CurrencyCode' } } }
    ParticipantSplitDto: { type: object, required: [personId, mode], properties: { personId: { type: string, format: uuid }, mode: { $ref: '#/components/schemas/SplitMode' }, percent: { type: string, nullable: true }, amount: { type: string, nullable: true } } }
    AccountProfile: { type: object, required: [id, email, name, preferredCurrency, emailVerified], properties: { id: { type: string, format: uuid }, email: { type: string, format: email }, name: { type: string }, preferredCurrency: { $ref: '#/components/schemas/CurrencyCode' }, emailVerified: { type: boolean } } }
    AuthTokens: { type: object, required: [accessToken, refreshToken, expiresInSeconds], properties: { accessToken: { type: string }, refreshToken: { type: string }, expiresInSeconds: { type: integer } } }
    AuthSessionResponse: { type: object, required: [account, tokens], properties: { account: { $ref: '#/components/schemas/AccountProfile' }, tokens: { $ref: '#/components/schemas/AuthTokens' } } }
    AccountProfileResponse: { type: object, required: [account], properties: { account: { $ref: '#/components/schemas/AccountProfile' } } }
    RegisterRequest: { type: object, required: [email, password, name], properties: { email: { type: string, format: email }, password: { type: string, minLength: 8 }, name: { type: string, minLength: 1, maxLength: 120 } } }
    VerifyEmailRequest: { type: object, required: [token], properties: { token: { type: string } } }
    LoginRequest: { type: object, required: [email, password], properties: { email: { type: string, format: email }, password: { type: string } } }
    RefreshRequest: { type: object, required: [refreshToken], properties: { refreshToken: { type: string } } }
    UpdatePreferencesRequest: { type: object, additionalProperties: false, properties: { preferredCurrency: { $ref: '#/components/schemas/CurrencyCode' }, timezone: { type: string } } }
    EventDto: { type: object, required: [id, ownerAccountId, name, baseCurrency, timezone, defaultSettlementAlgorithm], properties: { id: { type: string, format: uuid }, ownerAccountId: { type: string, format: uuid }, name: { type: string }, baseCurrency: { $ref: '#/components/schemas/CurrencyCode' }, timezone: { type: string }, defaultSettlementAlgorithm: { $ref: '#/components/schemas/SettlementAlgorithm' } } }
    PersonDto: { type: object, required: [id, eventId, displayName], properties: { id: { type: string, format: uuid }, eventId: { type: string, format: uuid }, displayName: { type: string }, linkedAccountId: { type: string, format: uuid, nullable: true } } }
    EntryDto: { type: object, required: [id, eventId, type, name, amount, currency, eventAmount, payerPersonId, participantSplits, occurredAtUtc], properties: { id: { type: string, format: uuid }, eventId: { type: string, format: uuid }, type: { $ref: '#/components/schemas/EntryType' }, name: { type: string }, categoryId: { type: string, format: uuid, nullable: true }, categoryName: { type: string, nullable: true }, amount: { type: string }, currency: { $ref: '#/components/schemas/CurrencyCode' }, eventAmount: { type: string }, payerPersonId: { type: string, format: uuid }, participantSplits: { type: array, items: { $ref: '#/components/schemas/ParticipantSplitDto' } }, occurredAtUtc: { type: string, format: date-time }, receiptUrls: { type: array, items: { type: string, format: uri } } } }
    BalanceDto: { type: object, required: [personId, netAmountInEventCurrency, owes, owedBy], properties: { personId: { type: string, format: uuid }, netAmountInEventCurrency: { type: string }, owes: { type: array, items: { type: object, required: [counterpartyPersonId, amount], properties: { counterpartyPersonId: { type: string, format: uuid }, amount: { $ref: '#/components/schemas/MoneyDto' } } } }, owedBy: { type: array, items: { type: object, required: [counterpartyPersonId, amount], properties: { counterpartyPersonId: { type: string, format: uuid }, amount: { $ref: '#/components/schemas/MoneyDto' } } } } } }
    AnalyticsDailyPointDto: { type: object, required: [date, total], properties: { date: { type: string, format: date }, total: { type: string }, byPerson: { type: array, items: { type: object, required: [personId, total], properties: { personId: { type: string, format: uuid }, total: { type: string } } } } } }
    AnalyticsCategoryPointDto: { type: object, required: [category, total], properties: { category: { type: string }, total: { type: string } } }
    CreateEventRequest: { type: object, required: [name, baseCurrency, timezone], properties: { name: { type: string }, baseCurrency: { $ref: '#/components/schemas/CurrencyCode' }, timezone: { type: string }, defaultSettlementAlgorithm: { $ref: '#/components/schemas/SettlementAlgorithm' } } }
    UpdateEventRequest: { type: object, properties: { name: { type: string }, timezone: { type: string }, defaultSettlementAlgorithm: { $ref: '#/components/schemas/SettlementAlgorithm' } } }
    CreatePersonRequest: { type: object, required: [displayName], properties: { displayName: { type: string }, linkedAccountId: { type: string, format: uuid, nullable: true } } }
    UpdatePersonRequest: { type: object, properties: { displayName: { type: string }, linkedAccountId: { type: string, format: uuid, nullable: true } } }
    CreateEntryRequest: { type: object, required: [type, name, amount, currency, payerPersonId, participantSplits, occurredAtUtc], properties: { type: { $ref: '#/components/schemas/EntryType' }, name: { type: string }, categoryId: { type: string, format: uuid, nullable: true }, categoryName: { type: string, nullable: true }, amount: { type: string }, currency: { $ref: '#/components/schemas/CurrencyCode' }, payerPersonId: { type: string, format: uuid }, participantSplits: { type: array, minItems: 1, items: { $ref: '#/components/schemas/ParticipantSplitDto' } }, occurredAtUtc: { type: string, format: date-time }, note: { type: string, nullable: true } } }
    UpdateEntryRequest: { type: object, properties: { name: { type: string }, categoryId: { type: string, format: uuid, nullable: true }, categoryName: { type: string, nullable: true }, amount: { type: string }, currency: { $ref: '#/components/schemas/CurrencyCode' }, payerPersonId: { type: string, format: uuid }, participantSplits: { type: array, minItems: 1, items: { $ref: '#/components/schemas/ParticipantSplitDto' } }, occurredAtUtc: { type: string, format: date-time }, note: { type: string, nullable: true } } }
    CreateInviteRequest: { type: object, additionalProperties: false, properties: { expiresAtUtc: { type: string, format: date-time, nullable: true } } }
    JoinInviteRequest: { type: object, required: [personId], properties: { personId: { type: string, format: uuid } } }
    PresignRequest: { type: object, required: [fileName, mimeType, sizeBytes, checksum], properties: { fileName: { type: string }, mimeType: { type: string }, sizeBytes: { type: integer, minimum: 1 }, checksum: { type: string } } }
    EventResponse: { type: object, required: [event], properties: { event: { $ref: '#/components/schemas/EventDto' } } }
    EventListResponse: { type: object, required: [items, page, pageSize, totalItems], properties: { items: { type: array, items: { $ref: '#/components/schemas/EventDto' } }, page: { type: integer }, pageSize: { type: integer }, totalItems: { type: integer } } }
    EventDetailsResponse: { type: object, required: [event, people], properties: { event: { $ref: '#/components/schemas/EventDto' }, people: { type: array, items: { $ref: '#/components/schemas/PersonDto' } }, collaborators: { type: array, items: { type: object, required: [accountId, role, joinedAt], properties: { accountId: { type: string, format: uuid }, role: { type: string }, joinedAt: { type: string, format: date-time } } } } } }
    PersonResponse: { type: object, required: [person], properties: { person: { $ref: '#/components/schemas/PersonDto' } } }
    EntryResponse: { type: object, required: [entry], properties: { entry: { $ref: '#/components/schemas/EntryDto' } } }
    InviteResponse: { type: object, required: [token, expiresAtUtc], properties: { token: { type: string }, expiresAtUtc: { type: string, format: date-time, nullable: true } } }
    JoinInviteResponse: { type: object, required: [eventId, personId], properties: { eventId: { type: string, format: uuid }, personId: { type: string, format: uuid } } }
    BalancesResponse: { type: object, required: [eventId, currency, algorithm, balances], properties: { eventId: { type: string, format: uuid }, currency: { $ref: '#/components/schemas/CurrencyCode' }, algorithm: { $ref: '#/components/schemas/SettlementAlgorithm' }, balances: { type: array, items: { $ref: '#/components/schemas/BalanceDto' } } } }
    DailySpendResponse: { type: object, required: [eventId, fromDate, toDate, points], properties: { eventId: { type: string, format: uuid }, fromDate: { type: string, format: date, nullable: true }, toDate: { type: string, format: date, nullable: true }, points: { type: array, items: { $ref: '#/components/schemas/AnalyticsDailyPointDto' } } } }
    CategorySpendResponse: { type: object, required: [eventId, fromDate, toDate, points], properties: { eventId: { type: string, format: uuid }, fromDate: { type: string, format: date, nullable: true }, toDate: { type: string, format: date, nullable: true }, points: { type: array, items: { $ref: '#/components/schemas/AnalyticsCategoryPointDto' } } } }
    PresignResponse: { type: object, required: [uploadUrl, method, headers, storageKey, expiresAtUtc], properties: { uploadUrl: { type: string, format: uri }, method: { type: string }, headers: { type: object, additionalProperties: { type: string } }, storageKey: { type: string }, expiresAtUtc: { type: string, format: date-time } } }
